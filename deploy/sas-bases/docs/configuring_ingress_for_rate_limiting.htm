<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="content-type" content="text/html; charset=utf-8">
        <link rel="stylesheet" type="text/css" href="sas.css"/>
        <title>Configuring Ingress for Rate Limiting</title>
    </head>
    <body>
        <h1 id="140053167643472configuring-ingress-for-rate-limiting">Configuring Ingress for Rate Limiting</h1>
<h2 id="140053167643472overview">Overview</h2>
<p>You can use the examples found within <code>$deploy/sas-bases/examples/security/web/rate-limiting</code> to enforce rate-limiting at the ingress-nginx controller for SAS Viya platform endpoints. The properties are applied to all Ingress resources deployed with the SAS Viya platform. If you are using any external load balancers or API gateways, enforcing rate-limiting with ingress-nginx is not optimal. Instead, enforce rate limiting through external technology. To read more about the available options in ingress-nginx, see https://github.com/kubernetes/ingress-nginx/blob/main/docs/user-guide/nginx-configuration/annotations.md#rate-limiting.</p>
<p>If you are deploying on Red Hat OpenShift, you must enforce rate-limiting at the OpenShift router instead. The properties are applied to all Route resources deployed with the SAS Viya platform. To read more about the available options in OpenShift, see https://docs.openshift.com/container-platform/4.15/networking/routes/route-configuration.html#nw-route-specific-annotations_route-configuration.</p>
<h2 id="140053167643472installation">Installation</h2>
<h3 id="140053167643472ingress-nginx">ingress-nginx</h3>
<p>Use these steps to apply the desired properties to your SAS Viya platform deployment.</p>
<ol>
<li>
<p>Copy the <code>$deploy/sas-bases/examples/security/web/rate-limiting/ingress-nginx-configmap-inputs.yaml</code> file to the location of your working container security overlay,
   such as <code>site-config/security/web/</code>.</p>
</li>
<li>
<p>Define the properties in the ingress-nginx-configmap-inputs.yaml file which match the desired configuration. To define a property, uncomment it and update its token value as described in the example file.</p>
</li>
<li>
<p>Add the relative path of ingress-nginx-configmap-inputs.yaml to the resources block of the base kustomization.yaml file (<code>$deploy/kustomization.yaml</code>). Here is an example:</p>
<pre class="highlight"><code class="language-yaml">...
resources:
...
- site-config/security/web/rate-limiting/ingress-nginx-configmap-inputs.yaml
...</code></pre>

</li>
<li>
<p>Add the relative path(s) of the corresponding transformer file(s) to the transformers block of the base kustomization.yaml file. There should be one transformer file added per property defined within the ConfigMap. Here is an example:</p>
<pre class="highlight"><code class="language-yaml">...
transformers:
...
- sas-bases/overlays/security/web/rate-limiting/update-ingress-nginx-limit-rps.yaml
- sas-bases/overlays/security/web/rate-limiting/update-ingress-nginx-limit-burst-multiplier.yaml
...</code></pre>

</li>
</ol>
<h3 id="140053167643472openshift">OpenShift</h3>
<p>When deploying to Red Hat OpenShift, use these steps to apply the desired properties to your SAS Viya platform deployment. Do not use the steps for the ingress-nginx controller.</p>
<ol>
<li>
<p>Copy the <code>$deploy/sas-bases/examples/security/web/rate-limiting/route-configmap-inputs.yaml</code> file to the location of your working container security overlay,
   such as <code>site-config/security/web/rate-limiting</code>.</p>
</li>
<li>
<p>Define the properties in the route-configmap-inputs.yaml file which match the desired configuration. To define a property, uncomment it and update its token value as described in the example file.</p>
</li>
<li>
<p>Add the relative path of route-configmap-inputs.yaml to the resources block of the base kustomization.yaml file (<code>$deploy/kustomization.yaml</code>). Here is an example:</p>
<pre class="highlight"><code class="language-yaml">...
resources:
...
- site-config/security/web/rate-limiting/route-configmap-inputs.yaml
...</code></pre>

</li>
<li>
<p>Add the relative path(s) of the corresponding transformer file(s) to the transformers block of the base kustomization.yaml file. There should be one transformer file added per property defined within the ConfigMap. Here is an example:</p>
<pre class="highlight"><code class="language-yaml">...
transformers:
...
- sas-bases/overlays/security/web/rate-limiting/update-route-rate-limit-connections.yaml
- sas-bases/overlays/security/web/rate-limiting/update-route-rate-limit-connections-rate-http.yaml
- sas-bases/overlays/security/web/rate-limiting/update-route-rate-limit-connections-rate-tcp.yaml
...</code></pre>

</li>
</ol>
    </body>
</html>